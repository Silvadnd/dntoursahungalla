<?php session_start();if(!isset($_SESSION['admin_id'])){header('Location: admin_login.php');exit;}function getContactMessages(){$messagesDir='../messages/';$messages=[];if(is_dir($messagesDir)){$files=glob($messagesDir.'contact_*.txt');rsort($files);foreach($files as $file){if(is_readable($file)){$content=file_get_contents($file);$filename=basename($file);$messages[]=['filename'=>$filename,'content'=>$content,'date'=>filemtime($file)];}}}return $messages;}if(isset($_GET['delete'])&&isset($_GET['filename'])){$filename=basename($_GET['filename']);$filepath='../messages/'.$filename;if(file_exists($filepath)&&strpos($filename,'contact_')===0){unlink($filepath);header('Location: view_messages.php?deleted=1');exit;}}$messages=getContactMessages(); ?><!doctypehtml><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>Contact Messages - DN Tours Admin</title><link href="../css/style.css"rel="stylesheet"><style>.admin-container{max-width:1200px;margin:2rem auto;padding:2rem;background:linear-gradient(135deg,#1a1a1a 0,#2d2d2d 50%,#1a1a1a 100%);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.4);border:1px solid rgba(255,126,41,.1)}.message-item{background:rgba(42,42,42,.5);border:1px solid rgba(255,126,41,.2);border-radius:8px;padding:1.5rem;margin-bottom:1.5rem}.message-content{white-space:pre-line;font-family:monospace;background:rgba(0,0,0,.3);padding:1rem;border-radius:4px;margin:1rem 0}.message-actions{text-align:right;margin-top:1rem}.delete-btn{background:#e74c3c;color:#fff;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer;text-decoration:none}.delete-btn:hover{background:#c0392b}.back-link{color:#ff7e29;text-decoration:none;margin-bottom:2rem;display:inline-block}.back-link:hover{text-decoration:underline}.message-count{color:#bbb;margin-bottom:2rem}.alert{padding:1rem;margin-bottom:1rem;border-radius:4px;background:rgba(40,167,69,.2);border:1px solid #28a745;color:#28a745}</style></head><body><header class="navbar"><div class="logo"><img alt="DN Tours Logo"class="logo-img"src="../assets/images/logo.png"> DN Tours Admin</div><a href="logout.php"class="btn">Logout</a></header><div class="admin-container"><a href="admin_panel.php"class="back-link">‚Üê Back to Admin Panel</a><h1 style="color:#ff7e29;margin-bottom:1rem">Contact Messages</h1><?php if(isset($_GET['deleted'])): ?><div class="alert">Message deleted successfully!</div><?php endif; ?><div class="message-count">Total messages:<?php echo count($messages); ?><?php if(count($messages)>0): ?>| <a href="test_email.php"style="color:#ff7e29">Test Email Setup</a><?php endif; ?></div><?php if(empty($messages)): ?><div style="text-align:center;color:#bbb;padding:2rem"><h3>No messages found</h3><p>Contact form submissions will appear here when received.</p><p>Messages are saved to the <code>/messages/</code> directory as backup files.</p></div><?php else: ?><?php foreach($messages as $message): ?><div class="message-item"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem"><strong style="color:#ff7e29">Message from:<?php echo date('Y-m-d H:i:s',$message['date']); ?></strong><small style="color:#bbb"><?php echo $message['filename']; ?></small></div><div class="message-content"><?php echo htmlspecialchars($message['content']); ?></div><div class="message-actions"><a href="?delete=1&filename=<?php echo urlencode($message['filename']); ?>"class="delete-btn"onclick='return confirm("Are you sure you want to delete this message?")'>Delete Message</a></div></div><?php endforeach; ?><?php endif; ?><hr style="margin:2rem 0;border-color:rgba(255,126,41,.2)"><h3 style="color:#ff7e29">Email Setup Status</h3><p style="color:#bbb">Messages are automatically saved to files as backup. <a href="test_email.php"style="color:#ff7e29">Test your email configuration</a> to enable automatic email notifications.</p></div></body></html>