<?php session_start();if(!isset($_SESSION['admin_id'])){header('Location: admin_login.php');exit;}require_once 'config.php';if($_SERVER['REQUEST_METHOD']==='POST'&&isset($_POST['action'])&&$_POST['action']==='upload'){if(isset($_FILES['gallery_images'])){$uploadDir='uploads/gallery/';if(!is_dir($uploadDir)){mkdir($uploadDir,0755,true);}$uploadedCount=0;foreach($_FILES['gallery_images']['tmp_name']as $key=>$tmp_name){if($_FILES['gallery_images']['error'][$key]===UPLOAD_ERR_OK){$fileExtension=strtolower(pathinfo($_FILES['gallery_images']['name'][$key],PATHINFO_EXTENSION));$allowedExtensions=['jpg','jpeg','png','gif'];if(in_array($fileExtension,$allowedExtensions)){$fileName=uniqid().'.'.$fileExtension;$uploadPath=$uploadDir.$fileName;if(move_uploaded_file($tmp_name,$uploadPath)){$stmt=$pdo->prepare("INSERT INTO gallery (image_url, image_name, category) VALUES (?, ?, ?)");$stmt->execute([$uploadPath,$_FILES['gallery_images']['name'][$key],$_POST['category']?? 'general']);$uploadedCount++;}}}}$success_message="$uploadedCount image(s) uploaded successfully!";}}if(isset($_GET['delete_image'])){$imageId=intval($_GET['delete_image']);$stmt=$pdo->prepare("SELECT image_url FROM gallery WHERE id = ?");$stmt->execute([$imageId]);$image=$stmt->fetch();if($image&&file_exists($image['image_url'])){unlink($image['image_url']);}$stmt=$pdo->prepare("DELETE FROM gallery WHERE id = ?");$stmt->execute([$imageId]);header('Location: admin_panel.php?tab=gallery');exit;}if(isset($_GET['delete_review'])){$reviewId=intval($_GET['delete_review']);$stmt=$pdo->prepare("DELETE FROM reviews WHERE id = ?");$stmt->execute([$reviewId]);header('Location: admin_panel.php?tab=reviews');exit;}$galleryStmt=$pdo->prepare("SELECT * FROM gallery ORDER BY uploaded_at DESC");$galleryStmt->execute();$galleryImages=$galleryStmt->fetchAll();$reviewsStmt=$pdo->prepare("SELECT * FROM reviews ORDER BY created_at DESC");$reviewsStmt->execute();$reviews=$reviewsStmt->fetchAll();$activeTab=$_GET['tab']?? 'gallery'; ?><!doctypehtml><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>Admin Panel - DN Tours</title><link href="../css/style.css"rel="stylesheet"><style>.admin-container{max-width:1200px;margin:2rem auto;padding:2rem;background:linear-gradient(135deg,#1a1a1a 0,#2d2d2d 50%,#1a1a1a 100%);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.4);border:1px solid rgba(255,126,41,.1)}.admin-header{text-align:center;margin-bottom:3rem}.admin-header h1{color:#ff7e29;margin-bottom:.5rem}.admin-tabs{display:flex;gap:1rem;margin-bottom:2rem;border-bottom:2px solid rgba(255,126,41,.2)}.admin-tab{padding:1rem 2rem;background:0 0;border:none;color:#bbb;cursor:pointer;transition:all .3s ease;border-bottom:3px solid transparent;text-decoration:none}.admin-tab.active{color:#ff7e29;border-bottom-color:#ff7e29}.tab-content{display:none}.tab-content.active{display:block}.upload-section{background:rgba(42,42,42,.5);border:2px dashed rgba(255,126,41,.3);border-radius:12px;padding:2rem;text-align:center;margin-bottom:2rem}.admin-gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-top:2rem}.admin-image-card{position:relative;background:#2d2d2d;border-radius:12px;overflow:hidden;transition:all .3s ease}.admin-image-card img{width:100%;height:200px;object-fit:cover}.image-actions{position:absolute;top:5px;right:5px;display:flex;gap:5px}.action-btn{background:rgba(0,0,0,.7);color:#fff;border:none;width:30px;height:30px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease;text-decoration:none}.delete-btn:hover{background:#e74c3c}.review-admin-item{background:rgba(42,42,42,.5);border:1px solid rgba(255,126,41,.2);border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.review-admin-content{flex:1}.review-admin-actions{display:flex;gap:.5rem}.delete-btn-review{background:#e74c3c;color:#fff;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer;text-decoration:none}@media (max-width:768px){.admin-gallery{grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}.admin-image-card img{height:180px}}@media (max-width:430px){.admin-gallery{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.8rem}.admin-image-card img{height:160px}}</style></head><body><header class="navbar"><div class="logo"><img alt="DN Tours Logo"src="../assets/images/logo.png"class="logo-img"> DN Tours Admin</div><a class="btn"href="logout.php">Logout</a></header><div class="admin-container"><div class="admin-header"><h1>Admin Panel</h1><p>Manage your gallery photos and reviews</p></div><?php if(isset($success_message)): ?><div class="notification notification-show notification-success"><span class="notification-message"><?php echo htmlspecialchars($success_message); ?></span></div><?php endif; ?><div class="admin-tabs"><a class="admin-tab<?php echo $activeTab==='gallery'?'active':''; ?>"href="?tab=gallery">Gallery Management</a> <a class="admin-tab<?php echo $activeTab==='reviews'?'active':''; ?>"href="?tab=reviews">Review Management</a> <a class="admin-tab"href="view_messages.php">Contact Messages</a></div><div class="tab-content<?php echo $activeTab==='gallery'?'active':''; ?>"id="gallery"><div class="upload-section"><h3>Upload New Photos</h3><p>Select multiple photos to add to your gallery</p><form enctype="multipart/form-data"method="POST"><input name="action"type="hidden"value="upload"><div class="form-group"><input name="gallery_images[]"type="file"accept="image/*"multiple required></div><div class="form-group"><input name="category"value="general"placeholder="Category (optional)"></div><button class="btn-submit"type="submit">Upload Photos</button></form></div><div class="admin-gallery"><?php foreach($galleryImages as $image): ?><div class="admin-image-card"><img alt="<?php echo htmlspecialchars($image['image_name']); ?>"src="<?php echo htmlspecialchars($image['image_url']); ?>"><div class="image-actions"><a class="action-btn delete-btn"href="?delete_image=<?php echo $image['id']; ?>&tab=gallery"onclick='return confirm("Are you sure you want to delete this image?")'>✕</a></div><div style="padding:1rem"><small style="color:#bbb"><?php echo htmlspecialchars($image['image_name']); ?></small></div></div><?php endforeach; ?></div></div><div class="tab-content<?php echo $activeTab==='reviews'?'active':''; ?>"id="reviews"><?php foreach($reviews as $review): ?><div class="review-admin-item"><div class="review-admin-content"><h4><?php echo htmlspecialchars($review['name']); ?>(<?php echo str_repeat('★',$review['rating']).str_repeat('☆',5-$review['rating']); ?>)</h4><p><?php echo htmlspecialchars($review['review_text']); ?></p><small>Email:<?php echo htmlspecialchars($review['email']?:'Not provided'); ?>| Date:<?php echo date('M j, Y',strtotime($review['created_at'])); ?></small></div><div class="review-admin-actions"><a class="delete-btn-review"href="?delete_review=<?php echo $review['id']; ?>&tab=reviews"onclick='return confirm("Are you sure you want to delete this review?")'>Delete</a></div></div><?php endforeach; ?></div></div></body></html>